# ğŸš€ Spring Boot Starter å®Œæ•´å¼€å‘æŒ‡å—

> ä»é›¶å¼€å§‹åˆ›å»ºç¬¦åˆè§„èŒƒçš„è‡ªå®šä¹‰ Spring Boot Starter - ä»¥ `api-logger-spring-boot-starter` ä¸ºä¾‹

## ğŸ“‘ ç›®å½•

1. [Spring Boot Starter åŸºç¡€æ¦‚å¿µ](#-spring-boot-starter-åŸºç¡€æ¦‚å¿µ)
2. [å‘½åè§„èŒƒè¯¦è§£](#-å‘½åè§„èŒƒè¯¦è§£)
3. [é¡¹ç›®æ¶æ„è®¾è®¡](#-é¡¹ç›®æ¶æ„è®¾è®¡)
4. [å®Œæ•´å®ç°æµç¨‹](#-å®Œæ•´å®ç°æµç¨‹)
5. [å®æˆ˜æ¡ˆä¾‹ï¼šAPI Logger Starter](#-å®æˆ˜æ¡ˆä¾‹api-logger-starter)
6. [ä½¿ç”¨æŒ‡å—](#-ä½¿ç”¨æŒ‡å—)
7. [æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹](#-æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹)
8. [æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤)

---

## ğŸ¯ Spring Boot Starter åŸºç¡€æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ Spring Boot Starterï¼Ÿ

Spring Boot Starter æ˜¯ä¸€ä¸ªä¾èµ–èšåˆå™¨ï¼Œå®ƒå°†ç›¸å…³çš„ä¾èµ–ã€è‡ªåŠ¨é…ç½®å’Œé»˜è®¤è®¾ç½®æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿé€šè¿‡æ·»åŠ ä¸€ä¸ªä¾èµ–å°±è·å¾—å®Œæ•´çš„åŠŸèƒ½ã€‚

### æ ¸å¿ƒæœºåˆ¶

#### 1. ä¾èµ–èšåˆ
Starter åŒ…çš„ `pom.xml` å¼•å…¥è¯¥åŠŸèƒ½éœ€è¦çš„æ‰€æœ‰ä¾èµ–ï¼š
- è‡ªåŠ¨é…ç½®æ¨¡å—
- æ ¸å¿ƒåº“
- ä¼ é€’ä¾èµ–

#### 2. è‡ªåŠ¨é…ç½®
è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒåœ¨äº `xxx-autoconfigure` åŒ…ï¼Œé€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°ï¼š

- **spring.factories æ–‡ä»¶**ï¼ˆSpring Boot 2.7 ä¹‹å‰ï¼‰ï¼š
```properties
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.example.apilogger.autoconfigure.ApiLoggerAutoConfiguration
```

- **AutoConfiguration.imports æ–‡ä»¶**ï¼ˆSpring Boot 2.7+ï¼‰ï¼š
```
com.example.apilogger.autoconfigure.ApiLoggerAutoConfiguration
```

#### 3. æ¡ä»¶è£…é…
ä½¿ç”¨æ¡ä»¶æ³¨è§£æ§åˆ¶é…ç½®ç”Ÿæ•ˆæ¡ä»¶ï¼š
```java
@Configuration
@ConditionalOnClass(EntityManagerFactory.class)
@ConditionalOnProperty(name = "api-logger.enabled", matchIfMissing = true)
@EnableConfigurationProperties(ApiLoggerProperties.class)
public class ApiLoggerAutoConfiguration {
    // é…ç½®ä»£ç 
}
```

---

## ğŸ·ï¸ å‘½åè§„èŒƒè¯¦è§£

### ğŸ”µ å®˜æ–¹ Starter å‘½åè§„èŒƒ

**æ ¼å¼ï¼š** `spring-boot-starter-{name}`

**ç¤ºä¾‹ï¼š**
- `spring-boot-starter-web`
- `spring-boot-starter-data-jpa`
- `spring-boot-starter-security`

**ä½¿ç”¨æƒé™ï¼š** ä»…é™ Spring Boot å®˜æ–¹å›¢é˜Ÿä½¿ç”¨

### ğŸŸ¢ ç¬¬ä¸‰æ–¹/è‡ªå®šä¹‰ Starter å‘½åè§„èŒƒ

**æ ¼å¼ï¼š** `{name}-spring-boot-starter`

**ç¤ºä¾‹ï¼š**
- `mybatis-spring-boot-starter`
- `druid-spring-boot-starter`
- `pagehelper-spring-boot-starter`
- `api-logger-spring-boot-starter` âœ…

### ğŸš¨ ä¸ºä»€ä¹ˆè¦éµå¾ªè§„èŒƒï¼Ÿ

1. **é¿å…å‘½åå†²çª** - é˜²æ­¢ä¸å®˜æ–¹ starter äº§ç”Ÿå†²çª
2. **æ¸…æ™°çš„æ‰€æœ‰æƒæ ‡è¯†** - åŒºåˆ†å®˜æ–¹å’Œç¬¬ä¸‰æ–¹ç»„ä»¶
3. **éµå¾ªç¤¾åŒºçº¦å®š** - æé«˜ç»„ä»¶çš„ä¸“ä¸šæ€§å’Œå¯ä¿¡åº¦

### å®Œæ•´å‘½åå¯¹æ¯”

| ç»„ä»¶ç±»å‹ | å®˜æ–¹æ ¼å¼ | ç¬¬ä¸‰æ–¹æ ¼å¼ | åŒ…åæ ¼å¼ | é…ç½®å‰ç¼€ |
|----------|----------|------------|----------|----------|
| **Starter** | `spring-boot-starter-*` | `*-spring-boot-starter` | `com.example.*` | `api-logger.*` |
| **AutoConfigure** | `spring-boot-autoconfigure-*` | `*-spring-boot-autoconfigure` | `com.example.*.autoconfigure` | é¿å… `spring.*` |

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„è®¾è®¡

### æ ‡å‡†æ¶æ„æ¨¡å¼

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ {name}-spring-boot-starter/              # ä¸» starter æ¨¡å—
â”‚   â””â”€â”€ pom.xml                              # ä¾èµ–èšåˆï¼Œæ—  Java ä»£ç 
â”œâ”€â”€ {name}-spring-boot-autoconfigure/        # è‡ªåŠ¨é…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ pom.xml                              # æ ¸å¿ƒä¾èµ–
â”‚   â”œâ”€â”€ src/main/java/
â”‚   â”‚   â””â”€â”€ com/example/{name}/autoconfigure/
â”‚   â”‚       â”œâ”€â”€ {Name}Properties.java       # é…ç½®å±æ€§ç±»
â”‚   â”‚       â”œâ”€â”€ {Name}Configuration.java    # æ ¸å¿ƒåŠŸèƒ½ç»„ä»¶
â”‚   â”‚       â””â”€â”€ {Name}AutoConfiguration.java # è‡ªåŠ¨é…ç½®ç±»
â”‚   â””â”€â”€ src/main/resources/META-INF/
â”‚       â”œâ”€â”€ spring.factories                 # è‡ªåŠ¨é…ç½®å£°æ˜
â”‚       â””â”€â”€ spring-configuration-metadata.json # é…ç½®å…ƒæ•°æ®
â””â”€â”€ {name}-demo/                             # æ¼”ç¤ºåº”ç”¨ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ pom.xml
    â””â”€â”€ src/main/java/com/example/demo/
```

### æ¨¡å—èŒè´£åˆ†å·¥

| æ¨¡å— | èŒè´£ | åŒ…å«å†…å®¹ |
|------|------|----------|
| **Starter** | ä¾èµ–èšåˆ | åªæœ‰ pom.xmlï¼Œå¼•å…¥æ‰€æœ‰å¿…éœ€ä¾èµ– |
| **AutoConfigure** | åŠŸèƒ½å®ç° | é…ç½®ç±»ã€å±æ€§ç±»ã€æ ¸å¿ƒç»„ä»¶ã€å…ƒæ•°æ® |
| **Demo** | ä½¿ç”¨æ¼”ç¤º | ç¤ºä¾‹åº”ç”¨ã€æµ‹è¯•ä»£ç ã€é…ç½®ç¤ºä¾‹ |

---

## ğŸ“ å®Œæ•´å®ç°æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Starter æ¨¡å—

**ç›®å½•ï¼š** `api-logger-spring-boot-starter/`

**pom.xmlï¼š**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0">
    <modelVersion>4.0.0</modelVersion>
    
    <groupId>com.example</groupId>
    <artifactId>api-logger-spring-boot-starter</artifactId>
    <version>1.0.0</version>
    <packaging>jar</packaging>
    
    <name>API Logger Spring Boot Starter</name>
    <description>Starter for automatic API request/response logging</description>
    
    <properties>
        <maven.compiler.source>11</maven.compiler.source>
        <maven.compiler.target>11</maven.compiler.target>
        <spring-boot.version>2.1.0.RELEASE</spring-boot.version>
    </properties>
    
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter</artifactId>
            <version>${spring-boot.version}</version>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
            <version>${spring-boot.version}</version>
        </dependency>
        <dependency>
            <groupId>com.example</groupId>
            <artifactId>api-logger-spring-boot-autoconfigure</artifactId>
            <version>${project.version}</version>
        </dependency>
    </dependencies>
</project>
```

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºè‡ªåŠ¨é…ç½®æ¨¡å—

#### 2.1 é…ç½®å±æ€§ç±»

**æ–‡ä»¶ï¼š** `ApiLoggerProperties.java`

```java
package com.example.apilogger.autoconfigure;

import org.springframework.boot.context.properties.ConfigurationProperties;
import java.util.ArrayList;
import java.util.List;

@ConfigurationProperties(prefix = "api-logger")
public class ApiLoggerProperties {
    
    private boolean enabled = true;
    private LogLevel level = LogLevel.INFO;
    private boolean includeRequestHeaders = true;
    private boolean includeResponseHeaders = true;
    private boolean includeRequestBody = true;
    private boolean includeResponseBody = false;
    private boolean includeRequestParams = true;
    private boolean includeExecutionTime = true;
    private int maxRequestBodySize = 10240;
    private int maxResponseBodySize = 10240;
    private List<String> excludePatterns = new ArrayList<>();
    private List<String> includePatterns = new ArrayList<>();
    private List<String> excludeHeaders = new ArrayList<>();
    private LogFormat format = LogFormat.JSON;
    
    public enum LogLevel {
        TRACE, DEBUG, INFO, WARN, ERROR
    }
    
    public enum LogFormat {
        JSON, PLAIN_TEXT
    }
    
    // æ„é€ å‡½æ•°è®¾ç½®é»˜è®¤å€¼
    public ApiLoggerProperties() {
        excludePatterns.add("/actuator/**");
        excludePatterns.add("/static/**");
        excludePatterns.add("/favicon.ico");
        
        excludeHeaders.add("Authorization");
        excludeHeaders.add("Cookie");
        excludeHeaders.add("X-Auth-Token");
    }
    
    // getter å’Œ setter æ–¹æ³•...
}
```

#### 2.2 æ ¸å¿ƒåŠŸèƒ½ç»„ä»¶

**æ–‡ä»¶ï¼š** `ApiLoggerInterceptor.java`

```java
package com.example.apilogger.autoconfigure;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.util.AntPathMatcher;
import org.springframework.util.StopWatch;
import org.springframework.web.servlet.HandlerInterceptor;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.util.*;

public class ApiLoggerInterceptor implements HandlerInterceptor {
    
    private final ApiLoggerProperties properties;
    private final ObjectMapper objectMapper;
    private final AntPathMatcher pathMatcher;
    
    public ApiLoggerInterceptor(ApiLoggerProperties properties, ObjectMapper objectMapper) {
        this.properties = properties;
        this.objectMapper = objectMapper;
        this.pathMatcher = new AntPathMatcher();
    }
    
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        if (!properties.isEnabled() || !shouldLog(request)) {
            return true;
        }
        
        // å¼€å§‹è®¡æ—¶
        if (properties.isIncludeExecutionTime()) {
            StopWatch stopWatch = new StopWatch();
            stopWatch.start();
            request.setAttribute("API_LOGGER_STOPWATCH", stopWatch);
        }
        
        // è®°å½•è¯·æ±‚æ—¥å¿—
        logRequest(request);
        return true;
    }
    
    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) {
        if (!properties.isEnabled() || !shouldLog(request)) {
            return;
        }
        
        // åœæ­¢è®¡æ—¶
        StopWatch stopWatch = (StopWatch) request.getAttribute("API_LOGGER_STOPWATCH");
        if (stopWatch != null) {
            stopWatch.stop();
        }
        
        // è®°å½•å“åº”æ—¥å¿—
        logResponse(request, response, stopWatch, ex);
    }
    
    // å…¶ä»–è¾…åŠ©æ–¹æ³•...
    private boolean shouldLog(HttpServletRequest request) {
        String uri = request.getRequestURI();
        
        // æ£€æŸ¥æ’é™¤æ¨¡å¼
        for (String pattern : properties.getExcludePatterns()) {
            if (pathMatcher.match(pattern, uri)) {
                return false;
            }
        }
        
        // æ£€æŸ¥åŒ…å«æ¨¡å¼
        if (!properties.getIncludePatterns().isEmpty()) {
            return properties.getIncludePatterns().stream()
                    .anyMatch(pattern -> pathMatcher.match(pattern, uri));
        }
        
        return true;
    }
    
    private void logRequest(HttpServletRequest request) {
        // å®ç°è¯·æ±‚æ—¥å¿—è®°å½•é€»è¾‘
    }
    
    private void logResponse(HttpServletRequest request, HttpServletResponse response, StopWatch stopWatch, Exception ex) {
        // å®ç°å“åº”æ—¥å¿—è®°å½•é€»è¾‘
    }
}
```

#### 2.3 è‡ªåŠ¨é…ç½®ç±»

**æ–‡ä»¶ï¼š** `ApiLoggerAutoConfiguration.java`

```java
package com.example.apilogger.autoconfigure;

import com.fasterxml.jackson.databind.ObjectMapper;
import org.springframework.boot.autoconfigure.AutoConfigureAfter;
import org.springframework.boot.autoconfigure.condition.*;
import org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration;
import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import javax.servlet.Servlet;

@Configuration
@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)
@ConditionalOnClass({Servlet.class, ApiLoggerInterceptor.class})
@ConditionalOnProperty(name = "api-logger.enabled", matchIfMissing = true)
@EnableConfigurationProperties(ApiLoggerProperties.class)
@AutoConfigureAfter(JacksonAutoConfiguration.class)
public class ApiLoggerAutoConfiguration {

    @Bean
    @ConditionalOnMissingBean
    public ApiLoggerInterceptor apiLoggerInterceptor(ApiLoggerProperties properties, ObjectMapper objectMapper) {
        return new ApiLoggerInterceptor(properties, objectMapper);
    }

    @Configuration
    @ConditionalOnClass(WebMvcConfigurer.class)
    static class ApiLoggerWebMvcConfiguration implements WebMvcConfigurer {

        private final ApiLoggerInterceptor apiLoggerInterceptor;

        public ApiLoggerWebMvcConfiguration(ApiLoggerInterceptor apiLoggerInterceptor) {
            this.apiLoggerInterceptor = apiLoggerInterceptor;
        }

        @Override
        public void addInterceptors(InterceptorRegistry registry) {
            registry.addInterceptor(apiLoggerInterceptor)
                    .addPathPatterns("/**")
                    .order(0);
        }
    }
}
```

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå…ƒæ•°æ®æ–‡ä»¶

#### 3.1 è‡ªåŠ¨é…ç½®å£°æ˜

**æ–‡ä»¶ï¼š** `src/main/resources/META-INF/spring.factories`

```properties
# Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.example.apilogger.autoconfigure.ApiLoggerAutoConfiguration
```

#### 3.2 é…ç½®å…ƒæ•°æ®

**æ–‡ä»¶ï¼š** `src/main/resources/META-INF/spring-configuration-metadata.json`

```json
{
  "groups": [
    {
      "name": "api-logger",
      "type": "com.example.apilogger.autoconfigure.ApiLoggerProperties",
      "description": "APIæ—¥å¿—è®°å½•é…ç½®å±æ€§"
    }
  ],
  "properties": [
    {
      "name": "api-logger.enabled",
      "type": "java.lang.Boolean",
      "description": "æ˜¯å¦å¯ç”¨APIæ—¥å¿—è®°å½•",
      "defaultValue": true
    },
    {
      "name": "api-logger.level",
      "type": "com.example.apilogger.autoconfigure.ApiLoggerProperties$LogLevel",
      "description": "æ—¥å¿—è®°å½•çº§åˆ«",
      "defaultValue": "INFO"
    },
    {
      "name": "api-logger.format",
      "type": "com.example.apilogger.autoconfigure.ApiLoggerProperties$LogFormat",
      "description": "æ—¥å¿—è®°å½•æ ¼å¼",
      "defaultValue": "JSON"
    }
  ],
  "hints": [
    {
      "name": "api-logger.level",
      "values": [
        {"value": "TRACE", "description": "TRACEçº§åˆ«"},
        {"value": "DEBUG", "description": "DEBUGçº§åˆ«"},
        {"value": "INFO", "description": "INFOçº§åˆ«"},
        {"value": "WARN", "description": "WARNçº§åˆ«"},
        {"value": "ERROR", "description": "ERRORçº§åˆ«"}
      ]
    }
  ]
}
```

---

## ğŸ› ï¸ å®æˆ˜æ¡ˆä¾‹ï¼šAPI Logger Starter

### é¡¹ç›®æ¦‚è¿°

æˆ‘ä»¬åˆ›å»ºçš„ `api-logger-spring-boot-starter` æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ API è¯·æ±‚æ—¥å¿—è®°å½• starterï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹æ€§ï¼š

- âœ… **ç¬¦åˆè§„èŒƒ**ï¼šä¸¥æ ¼éµå¾ªç¬¬ä¸‰æ–¹å‘½åè§„èŒƒ
- ğŸš€ **å¼€ç®±å³ç”¨**ï¼šé›¶é…ç½®å¯åŠ¨
- ğŸ“ **åŠŸèƒ½ä¸°å¯Œ**ï¼šè®°å½•è¯·æ±‚/å“åº”çš„å®Œæ•´ä¿¡æ¯
- ğŸ¯ **æ™ºèƒ½è¿‡æ»¤**ï¼šæ”¯æŒ URL æ¨¡å¼å’Œè¯·æ±‚å¤´è¿‡æ»¤
- âš¡ **æ€§èƒ½ç›‘æ§**ï¼šè‡ªåŠ¨è®°å½•æ¥å£æ‰§è¡Œæ—¶é—´
- ğŸ”’ **å®‰å…¨è€ƒè™‘**ï¼šé»˜è®¤æ’é™¤æ•æ„Ÿä¿¡æ¯

### é¡¹ç›®ç»“æ„

```
api-logger-spring-boot-starter/          # ä¸» starter æ¨¡å—
â”œâ”€â”€ pom.xml                              # ä¾èµ–èšåˆ
api-logger-spring-boot-autoconfigure/    # è‡ªåŠ¨é…ç½®æ¨¡å—
â”œâ”€â”€ pom.xml                              # æ ¸å¿ƒä¾èµ–
â”œâ”€â”€ src/main/java/com/example/apilogger/autoconfigure/
â”‚   â”œâ”€â”€ ApiLoggerProperties.java         # é…ç½®å±æ€§
â”‚   â”œâ”€â”€ ApiLoggerInterceptor.java        # æ ¸å¿ƒæ‹¦æˆªå™¨
â”‚   â””â”€â”€ ApiLoggerAutoConfiguration.java  # è‡ªåŠ¨é…ç½®
â””â”€â”€ src/main/resources/META-INF/
    â”œâ”€â”€ spring.factories                 # è‡ªåŠ¨é…ç½®å£°æ˜
    â””â”€â”€ spring-configuration-metadata.json # é…ç½®å…ƒæ•°æ®
api-logger-demo/                         # æ¼”ç¤ºåº”ç”¨
â”œâ”€â”€ pom.xml
â””â”€â”€ src/main/java/com/example/demo/
    â”œâ”€â”€ ApiLoggerDemoApplication.java
    â”œâ”€â”€ controller/UserController.java
    â””â”€â”€ entity/User.java
```

### æŠ€æœ¯å®ç°äº®ç‚¹

1. **æ¡ä»¶è£…é…æœºåˆ¶**
   - åªåœ¨ Servlet Web åº”ç”¨ä¸­ç”Ÿæ•ˆ
   - æ£€æŸ¥å¿…è¦çš„ç±»æ˜¯å¦å­˜åœ¨
   - æ”¯æŒé€šè¿‡é…ç½®å¼€å…³æ§åˆ¶

2. **æ™ºèƒ½è¿‡æ»¤ç³»ç»Ÿ**
   - ä½¿ç”¨ `AntPathMatcher` è¿›è¡Œè·¯å¾„åŒ¹é…
   - æ”¯æŒé€šé…ç¬¦æ¨¡å¼
   - å¯é…ç½®åŒ…å«/æ’é™¤è§„åˆ™

3. **æ€§èƒ½ä¼˜åŒ–**
   - è¯·æ±‚ä½“åªè¯»å–ä¸€æ¬¡å¹¶ç¼“å­˜
   - å¤§å†…å®¹è‡ªåŠ¨æˆªæ–­
   - å¼‚å¸¸å¤„ç†ä¸å½±å“ä¸šåŠ¡é€»è¾‘

4. **å®‰å…¨ä¿æŠ¤**
   - é»˜è®¤æ’é™¤æ•æ„Ÿè¯·æ±‚å¤´
   - æ”¯æŒè‡ªå®šä¹‰æ’é™¤è§„åˆ™
   - å†…å®¹å¤§å°é™åˆ¶

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

#### 1. æ·»åŠ ä¾èµ–

```xml
<dependency>
    <groupId>com.example</groupId>
    <artifactId>api-logger-spring-boot-starter</artifactId>
    <version>1.0.0</version>
</dependency>
```

#### 2. å¯åŠ¨åº”ç”¨

```java
@SpringBootApplication
public class YourApplication {
    public static void main(String[] args) {
        SpringApplication.run(YourApplication.class, args);
    }
}
```

#### 3. é…ç½®é€‰é¡¹

```yaml
# åŸºç¡€é…ç½®
api-logger:
  enabled: true
  level: INFO
  format: JSON

# å†…å®¹æ§åˆ¶
  include-request-headers: true
  include-response-headers: true
  include-request-body: true
  include-response-body: false
  include-request-params: true
  include-execution-time: true

# å¤§å°é™åˆ¶
  max-request-body-size: 10240
  max-response-body-size: 10240

# è¿‡æ»¤è§„åˆ™
  exclude-patterns:
    - "/actuator/**"
    - "/static/**"
    - "/favicon.ico"
  include-patterns:
    - "/api/**"
  exclude-headers:
    - "Authorization"
    - "Cookie"
    - "X-Auth-Token"
```

### æ—¥å¿—è¾“å‡ºç¤ºä¾‹

#### JSON æ ¼å¼ï¼ˆé»˜è®¤ï¼‰

```json
{
  "type": "REQUEST",
  "timestamp": "2024-01-15T10:30:45.123",
  "method": "POST",
  "uri": "/api/users",
  "remoteAddr": "127.0.0.1",
  "parameters": {},
  "headers": {
    "Content-Type": "application/json",
    "User-Agent": "curl/7.68.0"
  },
  "body": "{\"name\":\"æµ‹è¯•ç”¨æˆ·\",\"email\":\"test@example.com\"}"
}
```

#### çº¯æ–‡æœ¬æ ¼å¼

```
APIæ—¥å¿— - type=REQUEST timestamp=2024-01-15T10:30:45 method=POST uri=/api/users remoteAddr=127.0.0.1
```

### æ¼”ç¤ºåº”ç”¨

æˆ‘ä»¬æä¾›äº†å®Œæ•´çš„æ¼”ç¤ºåº”ç”¨ï¼ŒåŒ…å«ï¼š

```bash
# è¿è¡Œæ¼”ç¤ºåº”ç”¨
cd api-logger-demo
mvn spring-boot:run

# æµ‹è¯• API
curl http://localhost:8080/api/users
curl -X POST http://localhost:8080/api/users \
  -H "Content-Type: application/json" \
  -d '{"name":"æµ‹è¯•ç”¨æˆ·","email":"test@example.com","age":25}'
```

---

## ğŸ’¡ æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹

### å¼€å‘æœ€ä½³å®è·µ

#### 1. å‘½åè§„èŒƒ
```bash
# âœ… æ­£ç¡®çš„ç¬¬ä¸‰æ–¹å‘½å
{company-name}-spring-boot-starter
{project-name}-spring-boot-starter

# âŒ é”™è¯¯çš„å‘½åï¼ˆå®˜æ–¹ä¿ç•™ï¼‰
spring-boot-starter-{name}
```

#### 2. åŒ…åè§„èŒƒ
```java
// âœ… æ¨èçš„åŒ…å
com.example.{project}.autoconfigure
com.{company}.starter.{project}
io.github.{username}.{project}.autoconfigure

// âŒ é¿å…ä½¿ç”¨å®˜æ–¹åŒ…å
org.springframework.boot.autoconfigure.{project}
```

#### 3. é…ç½®å‰ç¼€
```yaml
# âœ… æ¨èçš„é…ç½®å‰ç¼€
api-logger:
  enabled: true

company-name.project-name:
  enabled: true

# âŒ é¿å…ä½¿ç”¨ spring å‰ç¼€
spring.api-logger:
  enabled: true
```

#### 4. æ¡ä»¶è£…é…
```java
// æ¨èçš„æ¡ä»¶ç»„åˆ
@ConditionalOnWebApplication(type = Type.SERVLET)  // åº”ç”¨ç±»å‹
@ConditionalOnClass({Servlet.class})               // ç±»å­˜åœ¨
@ConditionalOnProperty(name = "xxx.enabled", matchIfMissing = true) // é…ç½®æ§åˆ¶
@ConditionalOnMissingBean                          // é¿å…é‡å¤é…ç½®
```

#### 5. é…ç½®å±æ€§è®¾è®¡
```java
@ConfigurationProperties(prefix = "api-logger")
public class ApiLoggerProperties {
    // æä¾›åˆç†çš„é»˜è®¤å€¼
    private boolean enabled = true;
    
    // ä½¿ç”¨æšä¸¾é™åˆ¶å–å€¼èŒƒå›´
    private LogLevel level = LogLevel.INFO;
    
    // è€ƒè™‘å®‰å…¨æ€§
    private List<String> excludeHeaders = Arrays.asList("Authorization", "Cookie");
    
    // æ€§èƒ½è€ƒè™‘
    private int maxBodySize = 10240;
}
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®å»ºè®®

#### 1. æ€§èƒ½ä¼˜åŒ–é…ç½®
```yaml
api-logger:
  enabled: true
  level: WARN                    # å‡å°‘æ—¥å¿—é‡
  include-request-body: false    # é¿å…è®°å½•æ•æ„Ÿæ•°æ®
  include-response-body: false   # å‡å°‘å­˜å‚¨å¼€é”€
  max-request-body-size: 1024    # é™åˆ¶å¤§å°
  exclude-patterns:
    - "/health/**"               # æ’é™¤å¥åº·æ£€æŸ¥
    - "/metrics/**"              # æ’é™¤ç›‘æ§æ¥å£
```

#### 2. å¼€å‘ç¯å¢ƒé…ç½®
```yaml
api-logger:
  enabled: true
  level: DEBUG
  include-request-body: true
  include-response-body: true
  max-request-body-size: 10240
```

#### 3. å®‰å…¨é…ç½®
```yaml
api-logger:
  exclude-patterns:
    - "/auth/**"                 # è®¤è¯ç›¸å…³
    - "/admin/**"                # ç®¡ç†æ¥å£
    - "/sensitive/**"            # æ•æ„Ÿæ•°æ®
  exclude-headers:
    - "Authorization"
    - "Cookie"
    - "X-Auth-Token"
    - "X-API-Key"
```

### å¸¸è§é™·é˜±ä¸é¿å…æ–¹æ³•

#### 1. å‘½åç©ºé—´å†²çª
```java
// âŒ é”™è¯¯ï¼šä½¿ç”¨å®˜æ–¹å‘½åç©ºé—´
package org.springframework.boot.autoconfigure.myproject;

// âœ… æ­£ç¡®ï¼šä½¿ç”¨è‡ªå·±çš„å‘½åç©ºé—´
package com.example.myproject.autoconfigure;
```

#### 2. å¾ªç¯ä¾èµ–
```java
// âŒ å¯èƒ½å¯¼è‡´å¾ªç¯ä¾èµ–
@Bean
public A beanA(B beanB) { return new A(beanB); }

@Bean  
public B beanB(A beanA) { return new B(beanA); }

// âœ… æ­£ç¡®ï¼šé¿å…å¾ªç¯ä¾èµ–
@Bean
@ConditionalOnMissingBean
public A beanA() { return new A(); }
```

#### 3. é…ç½®ä¼˜å…ˆçº§é—®é¢˜
```java
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ matchIfMissing æä¾›é»˜è®¤è¡Œä¸º
@ConditionalOnProperty(name = "feature.enabled", matchIfMissing = true)

// âœ… æ­£ç¡®ï¼šè€ƒè™‘é…ç½®é¡ºåº
@AutoConfigureAfter(DataSourceAutoConfiguration.class)
```

#### 4. èµ„æºæ³„éœ²
```java
// âŒ é”™è¯¯ï¼šå¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²
@Bean
public ResourceManager resourceManager() {
    return new ResourceManager(); // æ²¡æœ‰é€‚å½“çš„æ¸…ç†æœºåˆ¶
}

// âœ… æ­£ç¡®ï¼šå®ç°é€‚å½“çš„æ¸…ç†
@Bean(destroyMethod = "cleanup")
public ResourceManager resourceManager() {
    return new ResourceManager();
}
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. è‡ªåŠ¨é…ç½®æœªç”Ÿæ•ˆ

**é—®é¢˜ç—‡çŠ¶ï¼š**
- Starter æ·»åŠ ååŠŸèƒ½ä¸å·¥ä½œ
- é…ç½®å±æ€§ä¸ç”Ÿæ•ˆ

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æ£€æŸ¥å¯åŠ¨æ—¥å¿—
# æŸ¥æ‰¾è‡ªåŠ¨é…ç½®ç›¸å…³æ—¥å¿—

# 2. å¯ç”¨è°ƒè¯•æ¨¡å¼
debug: true

# 3. æ£€æŸ¥æ¡ä»¶è£…é…
management.endpoints.web.exposure.include: conditions
# è®¿é—® /actuator/conditions

# 4. éªŒè¯ä¾èµ–
mvn dependency:tree | grep api-logger
```

**å¸¸è§åŸå› ï¼š**
```java
// æ£€æŸ¥æ¡ä»¶æ³¨è§£æ˜¯å¦æ»¡è¶³
@ConditionalOnClass({Servlet.class})        // ç±»æ˜¯å¦å­˜åœ¨
@ConditionalOnProperty(name = "xxx.enabled") // å±æ€§æ˜¯å¦æ­£ç¡®
@ConditionalOnWebApplication                 // åº”ç”¨ç±»å‹æ˜¯å¦åŒ¹é…
```

#### 2. é…ç½®å±æ€§ä¸ç”Ÿæ•ˆ

**é—®é¢˜ç—‡çŠ¶ï¼š**
- é…ç½®äº†å±æ€§ä½†ä¸ç”Ÿæ•ˆ
- IDE æ²¡æœ‰æ™ºèƒ½æç¤º

**è§£å†³æ–¹æ¡ˆï¼š**
```java
// 1. ç¡®è®¤æ³¨è§£æ­£ç¡®
@ConfigurationProperties(prefix = "api-logger")  // å‰ç¼€è¦åŒ¹é…
@EnableConfigurationProperties(ApiLoggerProperties.class) // å¯ç”¨é…ç½®

// 2. æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼
# YAML æ ¼å¼è¦æ­£ç¡®
api-logger:
  enabled: true  # æ³¨æ„ç¼©è¿›

# Properties æ ¼å¼
api-logger.enabled=true
```

#### 3. ç±»è·¯å¾„é—®é¢˜

**é—®é¢˜ç—‡çŠ¶ï¼š**
- ClassNotFoundException
- NoClassDefFoundError

**è§£å†³æ–¹æ¡ˆï¼š**
```xml
<!-- æ£€æŸ¥ä¾èµ–æ˜¯å¦æ­£ç¡® -->
<dependency>
    <groupId>com.example</groupId>
    <artifactId>api-logger-spring-boot-starter</artifactId>
    <version>1.0.0</version>
</dependency>

<!-- ç¡®è®¤å¿…è¦çš„ä¾èµ– -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
```

#### 4. ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜

**é—®é¢˜ç—‡çŠ¶ï¼š**
- æ–¹æ³•ä¸å­˜åœ¨å¼‚å¸¸
- æ¥å£ä¸å…¼å®¹

**è§£å†³æ–¹æ¡ˆï¼š**
```xml
<!-- ä½¿ç”¨å…¼å®¹çš„ Spring Boot ç‰ˆæœ¬ -->
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.1.0.RELEASE</version>
</parent>
```

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
```yaml
logging:
  level:
    org.springframework.boot.autoconfigure: DEBUG
    com.example.apilogger: DEBUG
```

#### 2. ä½¿ç”¨ Actuator ç«¯ç‚¹
```yaml
management:
  endpoints:
    web:
      exposure:
        include: ["conditions", "configprops", "beans"]
```

#### 3. æºç è°ƒè¯•
åœ¨å…³é”®ä½ç½®æ·»åŠ æ–­ç‚¹ï¼š
- è‡ªåŠ¨é…ç½®ç±»çš„ `@Bean` æ–¹æ³•
- æ¡ä»¶æ³¨è§£çš„åˆ¤æ–­é€»è¾‘
- æ ¸å¿ƒåŠŸèƒ½ç»„ä»¶çš„æ–¹æ³•

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Spring Boot Autoconfigure](https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.auto-configuration)
- [Creating Your Own Starter](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-auto-configuration)
- [Configuration Metadata](https://docs.spring.io/spring-boot/docs/current/reference/html/configuration-metadata.html)

### ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹ Starter æ¡ˆä¾‹
- [MyBatis Spring Boot Starter](https://github.com/mybatis/spring-boot-starter)
- [Druid Spring Boot Starter](https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter)
- [PageHelper Spring Boot Starter](https://github.com/pagehelper/pagehelper-spring-boot)

### ç›¸å…³å·¥å…·
- [Spring Boot Configuration Processor](https://docs.spring.io/spring-boot/docs/current/reference/html/configuration-metadata.html#configuration-metadata.annotation-processor)
- [Spring Boot Actuator](https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html)

---

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬æŒ‡å—ï¼Œæˆ‘ä»¬å®Œæ•´åœ°ä»‹ç»äº† Spring Boot Starter çš„å¼€å‘è¿‡ç¨‹ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°å®é™…å®ç°ï¼Œä»å‘½åè§„èŒƒåˆ°æœ€ä½³å®è·µã€‚å…³é”®è¦ç‚¹åŒ…æ‹¬ï¼š

1. **ä¸¥æ ¼éµå¾ªå‘½åè§„èŒƒ** - ä½¿ç”¨ `{name}-spring-boot-starter` æ ¼å¼
2. **åˆç†çš„æ¶æ„è®¾è®¡** - starter + autoconfigure åˆ†ç¦»æ¨¡å¼
3. **å®Œå–„çš„æ¡ä»¶è£…é…** - ä½¿ç”¨æ¡ä»¶æ³¨è§£æ§åˆ¶é…ç½®ç”Ÿæ•ˆ
4. **ç”¨æˆ·å‹å¥½çš„è®¾è®¡** - æä¾›é…ç½®å…ƒæ•°æ®å’Œåˆç†é»˜è®¤å€¼
5. **ç”Ÿäº§çº§çš„å®ç°** - è€ƒè™‘æ€§èƒ½ã€å®‰å…¨å’Œå¯ç»´æŠ¤æ€§

æˆ‘ä»¬çš„ `api-logger-spring-boot-starter` é¡¹ç›®æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€ç¬¦åˆè§„èŒƒçš„å®ç°æ¡ˆä¾‹ï¼Œå¯ä»¥ä½œä¸ºå¼€å‘å…¶ä»– starter çš„å‚è€ƒæ¨¡æ¿ã€‚

**è®°ä½ï¼šè§„èŒƒä¸ä»…ä»…æ˜¯çº¦å®šï¼Œæ›´æ˜¯ç¤¾åŒºåä½œå’Œé¡¹ç›®å¯ç»´æŠ¤æ€§çš„åŸºç¡€ã€‚éµå¾ªè§„èŒƒï¼Œè®©æˆ‘ä»¬çš„ä»£ç æ›´ä¸“ä¸šã€æ›´å¯é ã€‚**

---

*ğŸ“ æœ¬æ–‡æ¡£åŸºäº Spring Boot 2.1.0.RELEASE ç‰ˆæœ¬ç¼–å†™ï¼ŒæŸäº›ç»†èŠ‚å¯èƒ½å› ç‰ˆæœ¬è€Œå¼‚ã€‚* 